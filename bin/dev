#!/bin/sh
# Prefer Homebrew Ruby if available, fall back to system Ruby
if command -v brew >/dev/null 2>&1; then
  brew_ruby="$(brew --prefix ruby 2>/dev/null)/bin/ruby"
  if [ -x "$brew_ruby" ]; then
    exec "$brew_ruby" -x "$0" "$@"
  fi
fi
exec ruby -x "$0" "$@"

#!ruby
# frozen_string_literal: true

# Resolve symlink so Homebrew's bin/dev finds libexec/dev/{src,lib}. When this file is in bin/, both are at repo root.
script_dir = File.dirname(File.realpath(__FILE__))
root = (File.basename(script_dir) == "bin") ? File.dirname(script_dir) : script_dir
src = File.join(root, "src")
lib = File.join(root, "lib")
$LOAD_PATH.unshift(src) unless $LOAD_PATH.include?(src)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)

require "dev"

out = $stdout
ui = if out.tty?
  Dev::Cli::UiImpl.new(cli_ui: CLI::UI, spinners: true)
elsif ENV["CI"] || ENV["CLICOLOR_FORCE"]
  Dev::Cli::UiImpl.new(cli_ui: CLI::UI, spinners: false)
else
  Dev::Cli::NoUi.new
end
Dev::Runner.new.run(ARGV, out: out, ui: ui)
